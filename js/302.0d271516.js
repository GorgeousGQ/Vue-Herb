"use strict";(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[302],{8302:function(e,t,s){s.r(t),s.d(t,{default:function(){return j}});var a=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"usercenter"},[t("div",{ref:"navContainer",staticClass:"nav-container"}),t("div",{staticClass:"box"},[t("div",{staticClass:"left-box"},[t("div",{staticClass:"user"},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,limit:1}},[e.imageUrl?t("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("jpg/png格式，且不超过2MB")])]),t("div",{staticClass:"userInfo"},[t("div",{staticClass:"userInfo-name"},[e._v(e._s(e.nickname))]),t("div",{staticClass:"userInfo-mail"},[e._v(e._s(e.email))]),t("div",{staticClass:"tobackside",on:{click:function(t){return e.toBack()}}},[t("span",[e._v("前往后台管理系统")])])])],1),t("div",{staticClass:"menu"},[t("div",{on:{click:function(t){e.currentTab="PersonalInfo"}}},[e._v("个人资料")]),t("div",{on:{click:function(t){e.currentTab="Avatar"}}},[e._v("修改头像")]),t("div",{on:{click:function(t){e.currentTab="MyBlog"}}},[e._v("我的博客")]),t("div",{on:{click:function(t){e.currentTab="Safety"}}},[e._v("安全中心")]),t("div",{on:{click:function(t){e.currentTab="permission"}}},[e._v("管理员申请")])])]),t("div",{staticClass:"right-box"},[t(e.currentTab,{tag:"component"})],1)])])])},r=[],i=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"box"},[e._m(0),t("el-form",{ref:"formRef",attrs:{model:e.form,rules:e.formRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"用户ID",prop:"id"}},[t("el-input",{attrs:{disabled:!0},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1),t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{disabled:!0},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"名称",prop:"nickname"}},[t("el-input",{model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),t("el-form-item",{attrs:{label:"权限",prop:"right"}},[t("el-select",{attrs:{placeholder:"访问权限",disabled:!0},model:{value:e.form.right,callback:function(t){e.$set(e.form,"right",t)},expression:"form.right"}},[t("el-option",{attrs:{label:"管理员",value:"shanghai"}}),t("el-option",{attrs:{label:"普通用户",value:"beijing"}})],1)],1),t("el-form-item",{attrs:{label:"个人简介",prop:"mydesc"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.mydesc,callback:function(t){e.$set(e.form,"mydesc",t)},expression:"form.mydesc"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存修改")]),t("el-button",{attrs:{type:"primary"},on:{click:e.resetFn}},[e._v("重置")])],1)],1)],1)])},l=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title"},[t("h3",[e._v("个人资料")]),t("hr")])}],o=s(7877),n={data(){return{form:{id:this.$store.state.userInfo.id,username:this.$store.state.userInfo.username,nickname:this.$store.state.userInfo.nickname,email:this.$store.state.userInfo.email,right:"",mydesc:this.$store.state.userInfo.mydesc?this.$store.state.userInfo.mydesc:"这位用户很懒，啥都没写哦..."},formRules:{nickname:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:2,max:32,message:"长度应在2-32之间",trigger:"blur"}],email:[{required:!0,message:"请输入用户邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确！",trigger:"blur"}]}}},created(){console.log(this.$store.state.userInfo)},mounted(){},methods:{onSubmit(){this.$refs.formRef.validate((async e=>{if(!e)return!1;{this.form.id=this.$store.state.userInfo.id;const{data:e}=await(0,o.cZ)(this.form);if(0!==e.status)return this.$message.error("更新用户信息失败！");this.$message.success("更新成功！"),this.$store.dispatch("getUserInfoActions"),console.log(e)}}))},resetFn(){this.$refs.formRef.resetFields()}}},c=n,m=s(1001),u=(0,m.Z)(c,i,l,!1,null,"660c12b9",null),d=u.exports,f=function(){var e=this,t=e._self._c;return t("div",[e._m(0),t("el-card",{staticClass:"box-card"},[t("div",[e.avatar?t("img",{staticClass:"the_img",attrs:{src:e.avatar,alt:""}}):t("img",{staticClass:"the_img",attrs:{src:s(8955),alt:""}}),t("div",{staticClass:"btn-box"},[t("input",{ref:"iptRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:e.onFileChange}}),t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.chooseImg}},[e._v("选择图片")]),t("el-button",{attrs:{type:"success",icon:"el-icon-upload",disabled:""===e.avatar},on:{click:e.uploadFn}},[e._v("上传头像")])],1)]),t("div",{staticClass:"tips"},[e._v("头像上传大小不超过80kb")])])],1)},p=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title"},[t("h3",[e._v("修改头像")]),t("hr")])}],g={name:"UserAvatar",data(){return{avatar:""}},methods:{chooseImg(){this.$refs.iptRef.click()},onFileChange(e){let t=e.target.files;if(0===t.length);else{console.log(t[0]);const e=new FileReader;e.readAsDataURL(t[0]),e.onload=e=>{this.avatar=e.target.result}}},async uploadFn(){const{data:e}=await(0,o.fo)(this.avatar);if(0!==e.status)return this.$message.error(e.message);this.$message.success(e.message),this.$store.dispatch("getUserInfoActions")}}},h=g,v=(0,m.Z)(h,f,p,!1,null,"061f87e0",null),b=v.exports,_=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"box"},[e._m(0),t("div",{staticClass:"root"},[t("el-form",{ref:"passwordForm",attrs:{rules:e.formRules,model:e.form,"label-width":"150px"}},[t("el-form-item",{attrs:{label:"旧密码：",prop:"oldPwd",name:"oldPwd"}},[t("el-input",{model:{value:e.form.oldPwd,callback:function(t){e.$set(e.form,"oldPwd",t)},expression:"form.oldPwd"}})],1),t("el-form-item",{attrs:{label:"新密码：",prop:"newPwd",name:"newPwd"}},[t("el-input",{model:{value:e.form.newPwd,callback:function(t){e.$set(e.form,"newPwd",t)},expression:"form.newPwd"}})],1),t("el-form-item",{attrs:{label:"确认新密码：",prop:"newPwd2",name:"newPwd2"}},[t("el-input",{model:{value:e.form.newPwd2,callback:function(t){e.$set(e.form,"newPwd2",t)},expression:"form.newPwd2"}})],1)],1),t("el-button",{attrs:{type:"primary"},on:{click:e.updatePwd}},[e._v("保存修改")]),t("el-button",{on:{click:e.resetFn}},[e._v("重置")])],1)])])},w=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title"},[t("h3",[e._v("安全中心")]),t("hr")])}],$=(s(7658),{data(){const e=(e,t,s)=>{this.form.oldPwd===t?s(new Error("新旧密码不能相同！")):s()};var t=(e,t,s)=>{t!==this.form.newPwd?s(new Error("两次输入密码不一致!")):s()};return{form:{oldPwd:"",newPwd:"",newPwd2:""},formRules:{oldPwd:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/,message:"密码长度为6-20位，必须且只能包括数字、字母",trigger:"blur"}],newPwd:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/,message:"密码长度为6-20位，必须且只能包括数字、字母",trigger:"blur"},{validator:e,trigger:"blur"}],newPwd2:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/,message:"密码长度为6-20位，必须且只能包括数字、字母",trigger:"blur"},{validator:t,trigger:"blur"}]}}},methods:{updatePwd(){this.$refs.passwordForm.validate((async e=>{if(!e)return!1;{const{data:e}=await(0,o.SX)(this.form);if(0!==e.status)return this.$mesaage.error("更新密码失败！");this.$message.success("更新密码成功！请重新登陆！"),this.$refs.passwordForm.resetFields(),this.$store.commit("updateToken",""),this.$store.commit("updateUserInfo",{}),this.$router.push("/")}}))},resetFn(){this.$refs.passwordForm.resetFields()}}}),x=$,k=(0,m.Z)(x,_,w,!1,null,"4dc4dc99",null),y=k.exports,C=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"box"},[e._m(0),e._l(e.articles,(function(s){return t("el-card",{key:s.id,staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v(e._s(s.title))]),t("span",{staticClass:"isapproval",class:{red:"2"==s.approval,gray:"0"==s.approval,green:"1"==s.approval}},[e._v(e._s(s.approvalstr))]),t("el-button",{staticStyle:{float:"right",padding:"3px 7px",color:"red"},attrs:{type:"text"},on:{click:function(t){return e.deleteArticle(s)}}},[e._v("删除")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.showDialog(s)}}},[e._v("修改文章")]),t("el-dialog",{attrs:{title:"修改文章",visible:e.dialogFormVisible,"modal-append-to-body":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{staticStyle:{width:"80%"},attrs:{model:e.currentArticleInfo,rules:e.pubFormRules}},[t("el-form-item",{attrs:{label:"文章标题","label-width":"100px",prop:"title"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.currentArticleInfo.title,callback:function(t){e.$set(e.currentArticleInfo,"title",t)},expression:"currentArticleInfo.title"}})],1),t("el-form-item",{attrs:{label:"文章概述","label-width":"100px",prop:"articledesc"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.currentArticleInfo.articledesc,callback:function(t){e.$set(e.currentArticleInfo,"articledesc",t)},expression:"currentArticleInfo.articledesc"}})],1),t("el-form-item",{attrs:{label:"文章正文","label-width":"100px",prop:"content"}},[t("quill-editor",{model:{value:e.currentArticleInfo.content,callback:function(t){e.$set(e.currentArticleInfo,"content",t)},expression:"currentArticleInfo.content"}})],1),t("el-form-item",{attrs:{label:"文章图片"}},[t("el-upload",{ref:"uploadRef",refInFor:!0,staticClass:"upload-demo",attrs:{drag:"",action:"#","on-change":e.onChange,"file-list":e.picFile,"auto-upload":!1,accept:".jpeg, .png, .jpg","before-upload":e.beforeUpload,multiple:""}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateDialog()}}},[e._v("确 定")])],1)],1)],1),t("div",{staticClass:"article-info"},[t("div",{staticClass:"article-desc"},[e._v(e._s(s.desc))])])])}))],2),t("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"page-sizes":e.pageSizes,"page-size":e.pageSize,currentPage:e.currentPage,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)},I=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title"},[t("h3",[e._v("我的博客")]),t("hr")])}],P={data(){return{id:this.$store.state.userInfo.id,articles:[],currentPage:1,pageSize:5,pageSizes:[3,5],total:0,currentArticleInfo:[],dialogFormVisible:!1,imageUrl:"",picFile:[],approvalStr:[],pubFormRules:{title:[{required:!0,message:"请输入文章标题！",trigger:"blur"},{min:1,max:30,message:"文章标题长度为1-30个字符",trigger:"blur"}],articledesc:[{required:!0,message:"请输入文章简介！",trigger:"blur"},{min:1,max:30,message:"文章简介长度为1-30个字符",trigger:"blur"}],content:[{required:!0,message:"请输入文章正文！",trigger:"blur"}]}}},mounted(){this.getPageList(),this.getArticlesLength()},methods:{onChange(e){this.picFile[this.index]=e,this.index++,console.log(this.picFile)},async uploadPic(){let e=new FormData;this.picFile.forEach(((t,s)=>{e.append("imgFile",this.picFile[s].raw)})),axios({url:"http://127.0.0.1:2001/admin/addArticlePic",method:"POST",headers:{"Content-Type":"multipart/form-data",Authorization:localStorage.getItem("token")},data:e,params:{articleinfo:this.form}}).then((e=>{200==e.status?this.$message({type:"success",message:"图片上传成功"}):this.$message({type:"error",message:"图片上传失败"})}))},beforeUpload(e){},getArticlesLength(){this.$axios.get("/admin/getMyBlogUserListLength").then((e=>{200==e.status&&(this.total=JSON.parse(e.data.data[0].id))}))},getPageList(){this.$axios.get("/admin/getMyBlogUserArticles",{params:{pageSize:this.pageSize,currentPage:this.currentPage}}).then((e=>{200==e.status&&(this.articles=e.data.data)}))},handleCurrentChange(e){this.currentPage=e,this.getPageList()},handleSizeChange(e){this.pageSize=e,this.getPageList()},showDialog(e){this.currentArticleInfo=e,this.dialogFormVisible=!0},deleteArticle(e){this.currentArticleInfo=e,this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.delete("/admin/deleteArticle",{params:{id:this.currentArticleInfo.id}}).then((e=>{200==e.status&&this.$message({type:"success",message:"删除成功!"}),this.getPageList()}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},updateDialog(){this.dialogFormVisible=!1,this.$axios.post("/admin/updateArticleInfo",{currentArticleInfo:this.currentArticleInfo,id:this.currentArticleInfo.id}).then((e=>{200==e.status&&(console.log(e.data),this.currentArticleInfo=e.data,this.$message({type:"success",message:"修改成功，文章将重新等待审批！"}))}))}}},A=P,F=(0,m.Z)(A,C,I,!1,null,"0a30de31",null),S=F.exports,z=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"box"},[e._m(0),t("el-form",{ref:"formRef",attrs:{model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),t("el-form-item",{attrs:{label:"申请权限",prop:"right"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.right,callback:function(t){e.$set(e.form,"right",t)},expression:"form.right"}},[t("el-option",{attrs:{label:"超级管理员",value:"超级管理员"}}),t("el-option",{attrs:{label:"管理员",value:"管理员"}}),t("el-option",{attrs:{label:"普通用户",value:"普通用户"}})],1)],1),t("el-form-item",{staticStyle:{margin:"0"},attrs:{label:"申请理由",prop:"content"}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"medium",prop:"content"}},[t("quill-editor",{model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)],1),t("el-form-item",{staticStyle:{padding:"10px",margin:"0"}},[t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交申请")])],1)],1)],1)])},R=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"title"},[t("h3",[e._v("管理员申请")]),t("hr")])}],T={data(){return{form:{id:this.$store.state.userInfo.id,username:this.$store.state.userInfo.username,nickname:this.$store.state.userInfo.nickname,email:this.$store.state.userInfo.email,right:"",content:""}}},created(){},mounted(){},methods:{async onSubmit(){if(""==this.form.content)this.$message({type:"warning",message:"申请理由不能为空！"});else if(""==this.form.right)this.$message({type:"warning",message:"申请权限不能为空！"});else{console.log(this.form.content),console.log(this.form.right);const{data:e}=await(0,o.YH)(this.form);if(0!=e.status)return this.$message.error(e.message);this.$message.success(e.message)}}}},U=T,Z=(0,m.Z)(U,z,R,!1,null,"0c8aad5f",null),q=Z.exports,L={data(){return{currentTab:"PersonalInfo",imageUrl:"",imgResult:"",currentTab:"PersonalInfo",nickname:this.$store.state.userInfo.nickname,email:this.$store.state.userInfo.email,permissions:""}},components:{PersonalInfo:d,Avatar:b,Safety:y,MyBlog:S,Permission:q},methods:{toBack(){window.location.href="http://8.130.20.53:90"}}},B=L,D=(0,m.Z)(B,a,r,!1,null,"d1b25eee",null),j=D.exports},8955:function(e,t,s){e.exports=s.p+"img/1.f8852f8f.png"}}]);
//# sourceMappingURL=302.0d271516.js.map